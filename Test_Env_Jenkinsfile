pipeline {

	agent any

	environment {
	DOCKERHUB_CREDENTIALS = credentials('ericfontes-docker-hub') 
	}
		
	stages {

	  stage('Tooling versions') {

	    steps{
	      sh '''
	        docker --version
		docker compose version
		'''
		}
          }


	  stage('Build') {

	    steps {
	      sh 'docker context use default'
	      sh 'docker compose build'
	      sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
	      sh 'docker compose push'
              sh 'docker compose ps'
	       }
	  }

	  stage('Deploy') {
	    
	    steps {
              sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
	      sh 'docker context use default'
	      sh 'docker compose up'
	      sh 'docker compose ps --format json'
	      }
	  }
/**
	 stage('SonarCloud'){
	   steps{
	     withSonarQubeEnv('sonarcloud') {
               sh "./mvnw org.jacoco:jacoco-maven-plugin:prepare-agent verify \
               sonar:sonar -Dsonar.branch.name=${env.BRANCH_NAME}"
                }
	     }
	 }
**/
     }
 }
